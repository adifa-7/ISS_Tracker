<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive 3D Earth</title>
  <style>
    body { margin: 0; background: #000; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      60, window.innerWidth / window.innerHeight, 0.1, 1000
    );
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    const pointLight = new THREE.PointLight(0xffffff, 1);
    pointLight.position.set(10, 0, 20);
    scene.add(pointLight);

    // Variables for interaction
    let earth;
    let isDragging = false;
    let previousMousePosition = { x: 0, y: 0 };
    let earthRotation = { x: 0, y: 0 };

    // Event listeners for mouse drag
    renderer.domElement.addEventListener('mousedown', function(e) {
      isDragging = true;
      previousMousePosition.x = e.clientX;
      previousMousePosition.y = e.clientY;
    });
    renderer.domElement.addEventListener('mousemove', function(e) {
      if (!isDragging || !earth) return;
      const deltaX = e.clientX - previousMousePosition.x;
      const deltaY = e.clientY - previousMousePosition.y;

      // Adjust the multiplier for sensitivity (try 0.01 or 0.005 for fine-tuning)
      earth.rotation.y += deltaX * 0.01;
      earth.rotation.x += deltaY * 0.01;
      // Clamp rotation.x to avoid flipping over the top
      earth.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, earth.rotation.x));

      previousMousePosition.x = e.clientX;
      previousMousePosition.y = e.clientY;
    });
    renderer.domElement.addEventListener('mouseup', function(e) {
      isDragging = false;
    });
    renderer.domElement.addEventListener('mouseleave', function(e) {
      isDragging = false;
    });
    // Optional: support touch events
    renderer.domElement.addEventListener('touchstart', function(e) {
      if (e.touches.length == 1) {
        isDragging = true;
        previousMousePosition.x = e.touches[0].clientX;
        previousMousePosition.y = e.touches[0].clientY;
      }
    });
    renderer.domElement.addEventListener('touchmove', function(e) {
      if (!isDragging || !earth || e.touches.length != 1) return;
      const deltaX = e.touches[0].clientX - previousMousePosition.x;
      const deltaY = e.touches[0].clientY - previousMousePosition.y;
      earth.rotation.y += deltaX * 0.01;
      earth.rotation.x += deltaY * 0.01;
      earth.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, earth.rotation.x));
      previousMousePosition.x = e.touches[0].clientX;
      previousMousePosition.y = e.touches[0].clientY;
      e.preventDefault();
    });
    renderer.domElement.addEventListener('touchend', function(e) {
      isDragging = false;
    });

    // Load Earth texture
    const textureLoader = new THREE.TextureLoader();
    textureLoader.load(
      "https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg",
      function (texture) {
        const geometry = new THREE.SphereGeometry(2, 64, 64);
        const material = new THREE.MeshPhongMaterial({ map: texture });
        earth = new THREE.Mesh(geometry, material);
        scene.add(earth);
        camera.position.z = 6;

        // Animation loop
        function animate() {
          requestAnimationFrame(animate);
          renderer.render(scene, camera);
        }
        animate();
      }
    );

    // Responsive resize
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
